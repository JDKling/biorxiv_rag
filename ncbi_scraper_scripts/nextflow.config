/*
 * Nextflow configuration for NCBI/PMC scraper pipeline
 */

// Pipeline parameters
params {
    // Input parameters
    journals = null
    journal_file = null
    
    // Output parameters  
    output_dir = "results"
    
    // Processing parameters
    download_fulltext = false
    max_articles = null
    case_sensitive = false
    list_journals_only = false
    
    // Download parameters
    download_delay = 1.0
    max_retries = 3
    max_concurrent_downloads = 3
}

// Process configuration
process {
    // Default process settings
    errorStrategy = 'retry'
    maxRetries = 2
    
    // Memory and CPU settings
    withName: FETCH_PMC_METADATA {
        memory = '2 GB'
        cpus = 1
        time = '30m'
    }
    
    withName: FILTER_BY_JOURNALS {
        memory = '4 GB'
        cpus = 1
        time = '20m'
    }
    
    withName: LIST_JOURNALS {
        memory = '4 GB'
        cpus = 1
        time = '20m'
    }
    
    withName: PREPARE_DOWNLOAD_LIST {
        memory = '1 GB'
        cpus = 1
        time = '10m'
    }
    
    withName: DOWNLOAD_ARTICLES {
        memory = '1 GB'
        cpus = 1
        time = '4h'
        maxForks = params.max_concurrent_downloads
    }
}

// Executor configuration
executor {
    name = 'local'
    cpus = 4
    memory = '8 GB'
}

// Docker configuration
docker {
    enabled = false  // Set to true if using Docker
    runOptions = '-u $(id -u):$(id -g)'
}

// Singularity configuration  
singularity {
    enabled = false  // Set to true if using Singularity
    autoMounts = true
}

// Conda configuration
conda {
    enabled = true
    createTimeout = '30 min'
}

// Work directory
workDir = './work'

// Timeline and reports
timeline {
    enabled = true
    file = "${params.output_dir}/reports/timeline.html"
}

report {
    enabled = true
    file = "${params.output_dir}/reports/report.html"
}

trace {
    enabled = true
    file = "${params.output_dir}/reports/trace.txt"
}

dag {
    enabled = true
    file = "${params.output_dir}/reports/dag.svg"
}

// Manifest
manifest {
    name = 'NCBI/PMC Scraper'
    description = 'Pipeline to download open access papers from NCBI/PMC by journal'
    author = 'Your Name'
    version = '1.0.0'
    nextflowVersion = '>=21.04.0'
    homePage = 'https://github.com/your-org/torc'
}
